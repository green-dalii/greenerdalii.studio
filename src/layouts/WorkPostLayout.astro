---
import BaseLayout from "./BaseLayout.astro";
import "@fontsource/inter/variable.css";
import { Image } from "astro:assets";
import ContentSection from "../components/content-section.astro";
import "../styles/index.css";
import { Debug } from 'astro:components';
const { frontmatter } = Astro.props;
// const allImages = await Astro.glob(`/src/data/work/*/*.{jpeg,jpg,png,gif}`);
// const images = allImages.filter(path => {return path.default.src.includes(`${frontmatter.path}`)});
const allMedias = await Astro.glob(`/src/data/work/*/*.{jpeg,jpg,png,gif,mp4}`);
const medias = allMedias.reduce((acc, media) => {
  const mediaPath = typeof media.default === 'string' ? media.default : media.default.src;
  if (mediaPath.includes(`${frontmatter.path}`)) {
    acc.push(media);
  }
  return acc;
}, []);
console.log("&&&",allMedias)

const videoProps = {
  playsInline: true, 
  autoPlay: true,
  muted: true,
  loop: true  
}
---
<BaseLayout>
  <div class="mt-10 sm:py-32">
    <ContentSection
      title={frontmatter.title}
      subtitle={frontmatter.enTitle}
      id="project"
    >
      <Fragment slot="description">
        {frontmatter.description}
      </Fragment>
      <Fragment slot="description-below">
        {frontmatter.enDescription}
      </Fragment>
      <Fragment slot="content">
        <div class="flex scroll-mt-24 flex-col items-center gap-4 space-y-8">
          <div class="w-full max-w-7xl space-y-2">
            <div>
              {medias.map((media) => {
                const ext = typeof media.default === 'string' ? media.default.split('.').pop() : media.default.format;
                let mediaComponent;
            
                if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
                  mediaComponent = (
                    <Image
                      src={media.default}
                      width={media.default.width}
                      height={media.default.height}
                      alt={media.default.src.split('/').pop()}
                      quality="high"
                    />
                  );
                } else if (ext === 'mp4') {
                  mediaComponent = (
                    <video {...videoProps}>
                      <source src={typeof media.default === 'string' ? media.default : media.default.src} type="video/mp4" />
                    </video>
                  );
                }
            
                return mediaComponent;
              })}
            </div>
          </div>
        </div>
      </Fragment>
    </ContentSection>
  </div>
</BaseLayout>

